<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana Chat & Gallery ğŸŒ</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --bg: #efe7dd; /* ×¦×‘×¢ ×¨×§×¢ ×•×•××˜×¡××¤ */
            --card: #ffffff; 
            --text: #333; 
            --accent: #00a884; /* ×™×¨×•×§ ×•×•××˜×¡××¤ */
            --my-msg: #d9fdd3;
            --other-msg: #ffffff;
        }
        body.dark-mode {
            --bg: #0b141a; 
            --card: #1f2c34; 
            --text: #e9edef; 
            --accent: #00a884;
            --my-msg: #005c4b;
            --other-msg: #202c33;
        }
        body { 
            font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text);
            text-align: center; padding: 0; margin: 0; transition: 0.3s;
            background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); /* ×¨×§×¢ ×“××•×™ ×•×•××˜×¡××¤ */
            background-repeat: repeat;
        }
        
        /* ×›×•×ª×¨×ª */
        .header { background: var(--card); padding: 10px; position: sticky; top: 0; z-index: 1000; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        h1 { margin: 0; font-size: 1.2rem; color: var(--text); display: inline-block; }
        
        .container { background: var(--card); padding: 15px; max-width: 600px; margin: 0 auto; border-bottom: 1px solid #ddd; }
        body.dark-mode .container { border-bottom: 1px solid #333; }

        /* ×‘×—×™×¨×ª ××•×•×˜××¨ */
        .avatar-selection { margin-bottom: 10px; display: flex; justify-content: center; gap: 8px; overflow-x: auto; padding-bottom: 5px; }
        .avatar-option { font-size: 1.5rem; cursor: pointer; padding: 5px; border-radius: 50%; opacity: 0.5; transition: 0.2s; }
        .avatar-option.selected { opacity: 1; background: rgba(0, 168, 132, 0.2); transform: scale(1.1); }

        input[type="text"], textarea { 
            padding: 10px; border-radius: 20px; border: 1px solid #ccc; width: 90%; 
            text-align: center; margin-bottom: 10px; background: var(--card); color: var(--text); 
            font-family: inherit;
        }
        
        .tabs { margin: 10px 0; display: flex; justify-content: center; gap: 5px; }
        button { border: none; padding: 8px 15px; font-weight: bold; cursor: pointer; border-radius: 20px; font-size: 0.9rem; }
        .tab-btn { background: transparent; border: 1px solid var(--text); color: var(--text); }
        .tab-btn.active { background: var(--accent); color: white; border: 1px solid var(--accent); }
        
        .action-area { display: flex; flex-direction: column; gap: 5px; align-items: center; }
        .send-btn { background: var(--accent); color: white; border-radius: 50px; padding: 10px 30px; margin-top: 5px; }
        .bot-btn { background: #9c27b0; color: white; border-radius: 50px; font-size: 0.8rem; margin-top: 5px; }

        .night-toggle { position: fixed; top: 10px; left: 10px; background: #333; color: white; z-index: 2000; font-size: 0.8rem; border-radius: 50px; padding: 5px 10px; }

        /* --- ×”×’×œ×¨×™×” (×ª××•× ×•×ª) --- */
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; padding: 10px; max-width: 800px; margin: 0 auto; }
        .card-img { background: var(--card); border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card-img img { width: 100%; height: 150px; object-fit: cover; }
        .card-info { padding: 5px; font-size: 0.8rem; text-align: right; }

        /* --- ×”×¦'××˜ (×•×•××˜×¡××¤ ×¡×˜×™×™×œ) --- */
        .chat-list { display: flex; flex-direction: column; gap: 10px; padding: 20px 10px; max-width: 600px; margin: 0 auto; padding-bottom: 80px; }
        
        .msg-row { display: flex; width: 100%; margin-bottom: 5px; }
        .msg-row.me { justify-content: flex-end; } /* ×× ×™ ×‘×©×××œ */
        .msg-row.other { justify-content: flex-start; } /* ××—×¨×™× ×‘×™××™×Ÿ */
        
        /* ×‘×’×œ×œ RTL, flex-end ×–×” ×©×××œ ×•-flex-start ×–×” ×™××™×Ÿ */
        
        .msg-bubble {
            max-width: 75%;
            padding: 8px 12px;
            border-radius: 15px;
            position: relative;
            font-size: 0.95rem;
            line-height: 1.4;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            word-wrap: break-word;
            text-align: right;
        }

        /* ×¢×™×¦×•×‘ ×‘×•×¢×” ×©×œ×™ (×™×¨×•×§) */
        .msg-row.me .msg-bubble {
            background-color: var(--my-msg);
            border-radius: 15px 0 15px 15px;
        }

        /* ×¢×™×¦×•×‘ ×‘×•×¢×” ×©×œ ××—×¨×™× (×œ×‘×Ÿ) */
        .msg-row.other .msg-bubble {
            background-color: var(--other-msg);
            border-radius: 0 15px 15px 15px;
        }
        
        /* ×¢×™×¦×•×‘ ×‘×•×˜ */
        .msg-row.bot .msg-bubble {
            background-color: #f3e5f5;
            border: 1px solid #9c27b0;
            margin: 0 auto;
            text-align: center;
        }
        body.dark-mode .msg-row.bot .msg-bubble { background-color: #4a148c; border: none; }

        .sender-name { font-size: 0.75rem; font-weight: bold; color: var(--accent); margin-bottom: 2px; }
        .timestamp { font-size: 0.65rem; color: #999; text-align: left; margin-top: 4px; display: block; }
        body.dark-mode .timestamp { color: #aaa; }

        .like-btn { font-size: 0.8rem; background: none; border: none; cursor: pointer; color: #888; float: left; margin-right: 5px; }

        #overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:3000; justify-content:center; align-items:center; flex-direction:column; }
        #overlay img { max-width:95%; max-height:80%; border-radius: 10px; }
        .close-btn { background: white; color: black; margin-top: 20px; padding: 10px 30px; border:none; border-radius:50px; font-weight:bold; cursor:pointer;}

        .hidden { display: none; }
    </style>
</head>
<body>

    <button class="night-toggle" onclick="toggleNight()">ğŸŒ™</button>

    <div id="overlay">
        <img id="fullImg" src="">
        <button class="close-btn" onclick="closeImg()">×¡×’×•×¨</button>
    </div>

    <div class="header">
        <h1 onclick="secretClick()">Nano Banana ğŸŒ</h1>
        <div class="tabs">
            <button id="btn-chat" onclick="switchTab('chat')" class="tab-btn active">ğŸ’¬ ×¦'××˜</button>
            <button id="btn-real" onclick="switchTab('real')" class="tab-btn">ğŸ“¸ ×’×œ×¨×™×”</button>
            <button id="btn-nano" onclick="switchTab('nano')" class="tab-btn">ğŸŒ × × ×•</button>
        </div>
    </div>

    <div class="container">
        <div id="avatar-selection" class="avatar-selection"></div>
        <input type="text" id="uploaderName" placeholder="×›×ª×•×‘ ××ª ×”×©× ×©×œ×š ×›××Ÿ (×›×“×™ ×œ×–×”×•×ª ×”×•×“×¢×•×ª)" oninput="refreshChatView()">

        <div id="chat-input-area" class="action-area">
            <textarea id="chatInput" placeholder="×”×§×œ×“ ×”×•×“×¢×”..."></textarea>
            <button class="send-btn" onclick="sendChat()">×©×œ×™×—×” â¤</button>
            <button class="bot-btn" onclick="triggerBot()">ğŸ¤– ×‘× × ×”-×‘×•×˜</button>
        </div>

        <div id="img-input-area" class="action-area hidden">
            <input type="text" id="descInput" placeholder="×ª×™××•×¨ ×œ×ª××•× ×”...">
            <button class="send-btn" onclick="checkUpload()">ğŸ“· ×‘×—×¨ ×ª××•× ×” ×œ×”×¢×œ××”</button>
            <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="uploadFile()">
        </div>
        
        <div id="status" style="color: orange; font-weight: bold; margin-top:5px;"></div>
    </div>

    <div id="content-area"></div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyBR9taEgDlp4CaFa1oDlA2wM9ENoZD2V9U",
          authDomain: "nano-banana-gallery-4e291.firebaseapp.com",
          projectId: "nano-banana-gallery-4e291",
          storageBucket: "nano-banana-gallery-4e291.firebasestorage.app",
          messagingSenderId: "843216131791",
          appId: "1:843216131791:web:e63ec1ab2f70b0808dc9ba"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const COLLECTION_NAME = "banana_v3"; 
        
        let currentTab = 'chat';
        let clicks = 0;
        let allData = []; // × ×©××•×¨ ××ª ×”××™×“×¢ ×›×“×™ ×œ×¨×¢× ×Ÿ ×‘×œ×™ ×§×¨×™××•×ª ××™×•×ª×¨×•×ª

        const avatars = ['ğŸŒ', 'ğŸ¦', 'ğŸ˜', 'ğŸ¤–', 'ğŸ‘½', 'ğŸ’©', 'ğŸ¤¡', 'ğŸ‘»', 'âš½', 'ğŸš¬'];
        let selectedAvatar = avatars[0];

        // ×××’×¨ ×™×¨×™×“×•×ª
        const roasts = [
            "×”×˜×¡×˜×¨ ×©×œ×š ×‘×™×§×© ×ª×•×¡×¤×ª ×¡×™×›×•×Ÿ ×œ××©×›×•×¨×ª ××—×¨×™ ×”×˜×¡×˜ ××™×ª×š.",
            "×‘× ×•×ª ×œ× ××¡× × ×•×ª ××•×ª×š, ×”×Ÿ ×¤×©×•×˜ ×—×•×¡××•×ª ××ª ×”××¡×¤×¨ ××¨××©.",
            "×™×© ×œ×š ×¤×¨×•×¤×™×œ ×¦×‘××™ 97... ×‘×œ×”×™×•×ª × ×•×“× ×™×§.",
            "×”×™×“ ×§×“××™×ª ×©×œ×š × ×¨××™×ª ×›××• × ×§× ×™×§×™×™×”, ×•×”××—×•×¨×™×ª ×›××• ×¤×™×¨×”.",
            "××ª×” × ×¨××” ×›××• ××™×©×”×• ×©×™×•×¦×™× ×¤×˜×•×¨ ×–×§×Ÿ ×¢×œ '×›×™×¢×•×¨ ×™×ª×¨'.",
            "×× ×”×™×™×ª ×‘×¦×‘×, ×”×™×™×ª ××§×‘×œ ×¦×œ\"×© ×¢×œ ×™×›×•×œ×ª ×”×©×™× ×” ×‘×©××™×¨×•×ª.",
            "×”×¨×™×– ×©×œ×š ×‘××™× ×•×¡, ××ª×” ×—×™×™×‘ ×›×¨×™×–××” ×œ××¡ ×”×›× ×¡×”.",
            "××ª×” ×ª×”×™×” ×”× ×”×’ ×ª×•×¨×Ÿ ×œ× ×¦×—, ×›×™ ××£ ××—×“ ×œ× ×¡×•××š ×¢×œ×™×š ×¢× ×”××œ×›×•×”×•×œ.",
            "×”×“×‘×¨ ×”×™×—×™×“ ×©××ª×” ×›×•×‘×© ×–×” ××œ×¤×¤×•× ×™× ×—××•×¦×™×.",
            "××ª×” × ×¨××” ×›××• NPC ×©× ×ª×§×¢ ×‘×§×™×¨ ×‘-GTA.",
            "×”×”×•×¨×™× ×©×œ×š ×¢×“×™×™×Ÿ ××—×›×™× ×©×ª×¡×™×™× ××ª ×’×™×œ ×”×”×ª×‘×’×¨×•×ª.",
            "×‘××›×•×Ÿ ××ª×” ×¢×•×©×” ×‘×¢×™×§×¨ ××™××•×Ÿ ×œ×¡×ª ×•××™××•×Ÿ ××’×•×“×œ ×‘×˜×™×§×˜×•×§.",
            "×”××•×— ×©×œ×š ×‘××¦×‘ ×˜×™×¡×” ×›×‘×¨ 18 ×©× ×”.",
            "×‘×˜×™× ×“×¨ ××¤×™×œ×• ×”×‘×•×˜×™× ×¢×•×©×™× ×¢×œ×™×š ×¡××•×œ.",
            "××ª×” × ×•×”×’ ×›××• ××™×©×”×• ×©×§×™×‘×œ ×¨×™×©×™×•×Ÿ ×‘×§×•××‘×™× ×” ×‘×“×™××•× ×”.",
            "×™×© ×œ×š ×›×¨×™×–××” ×©×œ ××•×¨×” ×œ××ª××˜×™×§×” ×‘×™×•× ×”×•×¨×™×.",
            "×”×¨×™××•×ª ×©×œ×š × ×¨××•×ª ×›××• ××’×–×•×– ×©×œ ×˜×•×™×•×˜×” ×§×•×¨×•×œ×”.",
            "××ª×” ××¢×©×Ÿ ×•×•×™×¤ ×‘×˜×¢× ×ª×•×ª ×•××¨×’×™×© ×’× ×’×¡×˜×¨.",
            "××™×š × ×›×©×œ×ª ×‘×˜×¡×˜ ×¤× ×™××™? ×”×‘×•×—×Ÿ ×–×” ×”××•×¨×” ×©×œ×š!",
            "×™×© ×œ×š ×”×§×œ×•×ª ×‘××‘×—× ×™× ×›×™ ×”××•×¨×™× ××¨×—××™× ×¢×œ×™×š."
        ];

        function initAvatars() {
            const container = document.getElementById('avatar-selection');
            avatars.forEach(av => {
                const el = document.createElement('span');
                el.className = 'avatar-option';
                el.innerText = av;
                if(av === selectedAvatar) el.classList.add('selected');
                el.onclick = function() {
                    document.querySelectorAll('.avatar-option').forEach(e => e.classList.remove('selected'));
                    el.classList.add('selected');
                    selectedAvatar = av;
                }
                container.appendChild(el);
            });
        }
        initAvatars();

        function toggleNight() { document.body.classList.toggle('dark-mode'); }
        function secretClick() { clicks++; if(clicks===3){ if(prompt("×¡×™×¡××”:")==="1234") { document.body.classList.add('admin'); alert("××¦×‘ ×× ×”×œ!"); } clicks=0; } }

        function switchTab(t) { 
            currentTab = t;
            // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨×™×
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(t === 'chat' ? 'btn-chat' : (t==='real'?'btn-real':'btn-nano')).classList.add('active');

            // ×”×—×œ×¤×ª ××–×•×¨ ×§×œ×˜
            const chatArea = document.getElementById('chat-input-area');
            const imgArea = document.getElementById('img-input-area');
            
            if (t === 'chat') {
                chatArea.classList.remove('hidden');
                imgArea.classList.add('hidden');
            } else {
                chatArea.classList.add('hidden');
                imgArea.classList.remove('hidden');
            }
            renderContent();
        }

        // --- ×œ×•×’×™×§×” ×©×œ ×¦'××˜ ---
        function renderContent() {
            const container = document.getElementById('content-area');
            const myName = document.getElementById('uploaderName').value.trim();

            if (currentTab === 'chat') {
                // ××¦×‘ ×¦'××˜
                container.className = 'chat-list';
                container.innerHTML = '';
                
                allData.forEach(d => {
                    if (d.type !== 'chat') return;
                    
                    const isMe = d.user === myName;
                    const isBot = d.isBot;
                    
                    // ×§×‘×™×¢×ª ×”××—×œ×§×” (×× ×™ / ××—×¨ / ×‘×•×˜)
                    let rowClass = 'other';
                    if (isBot) rowClass = 'bot';
                    else if (isMe) rowClass = 'me';

                    // ×‘×•×¢×”
                    const bubble = document.createElement('div');
                    bubble.className = `msg-row ${rowClass}`;
                    
                    // ×ª××¨×™×š
                    let timeStr = "";
                    if(d.date) timeStr = d.date.toDate().toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit'});

                    // ×ª×•×›×Ÿ ×”×‘×•×¢×”
                    // ×× ×–×” ×× ×™ - ×œ× ×¦×¨×™×š ×©×. ×× ×–×” ××—×¨ - ×¦×¨×™×š ×©×.
                    let nameHtml = '';
                    if (!isMe && !isBot) {
                        nameHtml = `<div class="sender-name">${d.avatar||''} ${d.user}</div>`;
                    }
                    if (isBot) {
                        nameHtml = `<div class="sender-name">ğŸ¤– ×‘× × ×”-×‘×•×˜</div>`;
                    }

                    bubble.innerHTML = `
                        <div class="msg-bubble">
                            ${nameHtml}
                            <div>${d.text}</div>
                            <div style="margin-top:5px;">
                                <button class="like-btn" onclick="addLike('${d.id}')">ğŸŒ ${d.likes||0}</button>
                                <span class="timestamp">${timeStr}</span>
                            </div>
                        </div>
                    `;
                    container.appendChild(bubble);
                });
                // ×’×œ×™×œ×” ×œ××˜×”
                // window.scrollTo(0, document.body.scrollHeight);

            } else {
                // ××¦×‘ ×’×œ×¨×™×”
                container.className = 'gallery-grid';
                container.innerHTML = '';

                allData.forEach(d => {
                    if (d.type !== 'image' || d.tab !== currentTab) return;
                    
                    const card = document.createElement('div');
                    card.className = 'card-img';
                    card.innerHTML = `
                        <img src="${d.img}" onclick="openImg('${d.img}')">
                        <div class="card-info">
                            <b>${d.avatar||''} ${d.user}</b><br>
                            <span>${d.desc||''}</span><br>
                            <button onclick="addLike('${d.id}')" style="border:none; background:none;">ğŸŒ ${d.likes||0}</button>
                            ${document.body.classList.contains('admin') ? `<button onclick="deletePost('${d.id}')">ğŸ—‘ï¸</button>` : ''}
                        </div>
                    `;
                    container.appendChild(card);
                });
            }
        }

        // ×”××–× ×” ×œ×©×™× ×•×™ ×‘×©× ×›×“×™ ×œ×¨×¢× ×Ÿ ×¦×“×“×™× ×‘×¦'××˜
        function refreshChatView() {
            if (currentTab === 'chat') renderContent();
        }

        // --- ×¤×¢×•×œ×•×ª ---
        function sendChat() {
            const name = document.getElementById('uploaderName').value;
            const text = document.getElementById('chatInput').value;
            if(!name) return alert("×›×ª×•×‘ ×©×!");
            if(!text) return;

            db.collection(COLLECTION_NAME).add({
                type: 'chat', text: text, user: name, avatar: selectedAvatar, tab: 'chat', likes: 0,
                date: firebase.firestore.FieldValue.serverTimestamp()
            });
            document.getElementById('chatInput').value = "";
            confetti({ particleCount: 50, spread: 50, origin: { y: 0.8 } });
        }

        function triggerBot() {
            const txt = roasts[Math.floor(Math.random() * roasts.length)];
            db.collection(COLLECTION_NAME).add({
                type: 'chat', text: txt, user: 'BananaBot', avatar: 'ğŸ¤–', tab: 'chat', likes: 0, isBot: true,
                date: firebase.firestore.FieldValue.serverTimestamp()
            });
            confetti();
        }

        function checkUpload() {
            if(!document.getElementById('uploaderName').value) return alert("×›×ª×•×‘ ×©×!");
            document.getElementById('fileInput').click();
        }

        function uploadFile() {
            const file = document.getElementById('fileInput').files[0];
            const name = document.getElementById('uploaderName').value;
            const desc = document.getElementById('descInput').value;
            if(!file) return;
            document.getElementById('status').innerText = "××¢×œ×”...";
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const max = 800; let w=img.width, h=img.height;
                    if(w>h){if(w>max){h*=max/w;w=max}}else{if(h>max){w*=max/h;h=max}}
                    canvas.width=w; canvas.height=h; ctx.drawImage(img,0,0,w,h);
                    
                    db.collection(COLLECTION_NAME).add({
                        type: 'image', img: canvas.toDataURL('image/jpeg', 0.6),
                        user: name, avatar: selectedAvatar, desc: desc, tab: currentTab, likes: 0,
                        date: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        document.getElementById('status').innerText = "";
                        document.getElementById('descInput').value = "";
                        confetti();
                    });
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function addLike(id) { db.collection(COLLECTION_NAME).doc(id).update({likes: firebase.firestore.FieldValue.increment(1)}); }
        function deletePost(id) { if(confirm("×œ××—×•×§?")) db.collection(COLLECTION_NAME).doc(id).delete(); }
        
        function openImg(u) { document.getElementById('fullImg').src=u; document.getElementById('overlay').style.display='flex'; }
        function closeImg() { document.getElementById('overlay').style.display='none'; }

        // ×”××–× ×” ×œ×©×™× ×•×™×™× ×‘-Firebase
        db.collection(COLLECTION_NAME).orderBy("date", "asc").onSnapshot(snap => {
            allData = [];
            snap.forEach(doc => {
                let d = doc.data();
                d.id = doc.id;
                allData.push(d);
            });
            // ×× ×× ×—× ×• ×‘×’×œ×¨×™×”, × ×”×¤×•×š ××ª ×”×¡×“×¨ (×”×—×“×© ×œ××¢×œ×”)
            if(currentTab !== 'chat') allData.reverse();
            
            renderContent();
            
            // ×’×œ×™×œ×” ××•×˜×•××˜×™×ª ×œ××˜×” ×‘×¦'××˜ ×¨×§ ×× × ×•×¡×¤×” ×”×•×“×¢×” ×—×“×©×”
            if(currentTab === 'chat') setTimeout(() => window.scrollTo(0, document.body.scrollHeight), 100);
        });
    </script>
</body>
</html>
