<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nano Banana Gallery & Chat ğŸŒ</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        :root {
            --bg: #fff9c4; --card: #ffffff; --text: #333; --border: gold; --accent: #ffd700;
        }
        body.dark-mode {
            --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; --border: #444; --accent: #ffee00;
        }
        body { 
            font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text);
            text-align: center; padding: 20px; margin: 0; transition: 0.3s;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 100 100"><text x="50%" y="50%" font-size="30" text-anchor="middle" dy=".3em" opacity="0.1">ğŸŒ</text></svg>');
        }
        h1 { background: var(--accent); padding: 10px 30px; border-radius: 50px; border: 4px solid #fff; display: inline-block; cursor: pointer; color: #3e2723; user-select: none; }
        
        .container { background: var(--card); padding: 20px; border-radius: 20px; max-width: 500px; margin: 10px auto; border: 2px solid var(--border); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        input[type="text"], textarea { 
            padding: 12px; border-radius: 10px; border: 1px solid #ccc; width: 85%; 
            text-align: center; margin-bottom: 10px; background: var(--card); color: var(--text); font-family: inherit;
        }
        textarea { resize: none; height: 60px; }
        
        .tabs { margin: 20px 0; display: flex; justify-content: center; gap: 5px; flex-wrap: wrap; }
        button { border: none; padding: 10px 15px; font-weight: bold; cursor: pointer; border-radius: 50px; margin: 2px; transition: 0.2s; font-size: 0.9rem; }
        .tab-btn { background: var(--card); border: 2px solid var(--border); color: var(--text); }
        .tab-btn.active { background: var(--accent); color: black; box-shadow: 0 0 10px orange; transform: scale(1.05); }
        
        .upload-btn { background: #4caf50; color: white; width: 100%; margin-top: 5px; font-size: 1.1rem; }
        .chat-btn { background: #2196F3; color: white; width: 100%; margin-top: 5px; font-size: 1.1rem; }
        
        .night-toggle { position: fixed; top: 10px; left: 10px; background: #333; color: white; z-index: 100; font-size: 0.8rem; }

        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; max-width: 1200px; margin: 20px auto; }
        
        .card { background: var(--card); border-radius: 15px; border: 1px solid var(--border); overflow: hidden; text-align: right; box-shadow: 0 4px 8px rgba(0,0,0,0.1); position: relative; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

        .card img { width: 100%; height: 220px; object-fit: cover; cursor: pointer; }
        
        .card-content { padding: 15px; }
        .user-name { font-weight: bold; font-size: 1.1rem; color: var(--accent); text-shadow: 0px 0px 1px black; }
        .upload-date { font-size: 0.75rem; color: #888; margin-bottom: 5px; }
        .description { font-size: 0.95rem; margin: 8px 0; padding: 8px; background: rgba(0,0,0,0.05); border-radius: 8px; border-right: 4px solid var(--accent); }
        
        /* ×¢×™×¦×•×‘ ××™×•×—×“ ×œ×”×•×“×¢×•×ª ×¦'××˜ */
        .chat-text { font-size: 1.1rem; padding: 10px; background: rgba(255, 215, 0, 0.1); border-radius: 10px; margin: 10px 0; white-space: pre-wrap; }

        .actions { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
        .action-btn { background: #eee; color: #333; font-size: 0.85rem; padding: 8px 12px; flex: 1; border-radius: 8px; }
        body.dark-mode .action-btn { background: #333; color: white; }
        
        .delete-btn { display: none; background: #ff4444; color: white; flex: 100%; margin-top: 5px; }
        body.admin .delete-btn { display: block; }

        .comments { display: none; padding: 10px; background: rgba(0,0,0,0.03); border-top: 1px solid var(--border); max-height: 200px; overflow-y: auto; }
        .comment { font-size: 0.85rem; border-bottom: 1px solid #ddd; padding: 8px 0; }
        .comment b { color: #d84315; }

        #overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:2000; justify-content:center; align-items:center; flex-direction:column; }
        #overlay img { max-width:95%; max-height:85%; border: 2px solid white; box-shadow: 0 0 30px var(--accent); border-radius: 10px; }
        .close-btn { background: var(--accent); color: black; margin-top: 20px; padding: 10px 40px; font-size: 1.2rem; }

        .spy { display: none; font-size: 0.6rem; color: #0f0; background: black; padding: 5px; margin-top: 5px; direction: ltr; }
        body.admin .spy { display: block; }
        
        /* ×”×¡×ª×¨×ª ××–×•×¨×™× */
        .hidden { display: none; }
    </style>
</head>
<body>

    <button class="night-toggle" onclick="toggleNight()">ğŸŒ™ ×œ×™×œ×”/×™×•×</button>

    <div id="overlay">
        <img id="fullImg" src="">
        <button class="close-btn" onclick="closeImg()">×¡×’×•×¨ ×ª××•× ×” âœ–ï¸</button>
    </div>

    <h1 onclick="secretClick()">Nano Banana Gallery ğŸŒ</h1>

    <div class="tabs">
        <button id="btn-real" onclick="switchTab('real')" class="tab-btn active">ğŸ“¸ ×’×œ×¨×™×” ×××™×ª×™×ª</button>
        <button id="btn-nano" onclick="switchTab('nano')" class="tab-btn">ğŸŒ × × ×• ×‘× × ×”</button>
        <button id="btn-chat" onclick="switchTab('chat')" class="tab-btn">ğŸ’¬ ×”×¦'××˜ ×”×¡×•×“×™</button>
    </div>

    <div class="container">
        <input type="text" id="uploaderName" placeholder="×”×©× ×©×œ×š (×—×•×‘×”)" style="border: 2px solid var(--accent);">
        
        <div id="image-upload-area">
            <input type="text" id="descInput" placeholder="×ª×™××•×¨ ×œ×ª××•× ×” (××•×¤×¦×™×•× ×œ×™)" maxlength="50">
            <button class="upload-btn" onclick="checkUpload()">â• ×”×¢×œ×” ×ª××•× ×”</button>
            <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="uploadFile()">
        </div>

        <div id="chat-upload-area" class="hidden">
            <textarea id="chatInput" placeholder="×›×ª×•×‘ ×›××Ÿ ×”×•×“×¢×” ×œ×—×‘×¨×™×..."></textarea>
            <button class="chat-btn" onclick="sendChat()">ğŸš€ ×©×œ×— ×”×•×“×¢×”</button>
        </div>
        
        <p id="status" style="font-weight:bold; color:orange;"></p>
    </div>

    <div id="gallery" class="gallery"></div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyBR9taEgDlp4CaFa1oDlA2wM9ENoZD2V9U",
          authDomain: "nano-banana-gallery-4e291.firebaseapp.com",
          projectId: "nano-banana-gallery-4e291",
          storageBucket: "nano-banana-gallery-4e291.firebasestorage.app",
          messagingSenderId: "843216131791",
          appId: "1:843216131791:web:e63ec1ab2f70b0808dc9ba"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        // ××©×ª××©×™× ×‘××•×ª×• ×××’×¨ ×›×“×™ ×œ×©××•×¨ ×¢×œ ×”×ª××•× ×•×ª ×”×™×©× ×•×ª!
        const COLLECTION_NAME = "banana_v3"; 
        
        let currentTab = 'real';
        let clicks = 0;

        function toggleNight() { document.body.classList.toggle('dark-mode'); }
        
        function secretClick() { 
            clicks++; 
            if(clicks===3){ 
                if(prompt("×¡×™×¡××ª ×× ×”×œ:")==="1234") {
                    document.body.classList.add('admin'); 
                    alert("××¦×‘ ×× ×”×œ ×”×•×¤×¢×œ! ğŸ•µï¸â€â™‚ï¸");
                }
                clicks=0; 
            } 
        }

        function switchTab(t) { 
            currentTab = t; 
            
            // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨×™×
            document.getElementById('btn-real').className = t==='real'?'tab-btn active':'tab-btn'; 
            document.getElementById('btn-nano').className = t==='nano'?'tab-btn active':'tab-btn'; 
            document.getElementById('btn-chat').className = t==='chat'?'tab-btn active':'tab-btn'; 

            // ×”×—×œ×¤×ª ×ª×™×‘×•×ª ×§×œ×˜
            const imgArea = document.getElementById('image-upload-area');
            const chatArea = document.getElementById('chat-upload-area');
            
            if (t === 'chat') {
                imgArea.classList.add('hidden');
                chatArea.classList.remove('hidden');
            } else {
                imgArea.classList.remove('hidden');
                chatArea.classList.add('hidden');
            }

            loadContent(); 
        }

        function checkUpload() { 
            if(!document.getElementById('uploaderName').value) return alert("×—×•×‘×” ×œ×›×ª×•×‘ ×©×!"); 
            document.getElementById('fileInput').click(); 
        }

        function openImg(u) { document.getElementById('fullImg').src=u; document.getElementById('overlay').style.display='flex'; }
        function closeImg() { document.getElementById('overlay').style.display='none'; }

        // ×©×œ×™×—×ª ×”×•×“×¢×ª ×¦'××˜
        function sendChat() {
            const name = document.getElementById('uploaderName').value;
            const text = document.getElementById('chatInput').value;
            
            if(!name) return alert("××™ ××ª×”? ×›×ª×•×‘ ×©×!");
            if(!text) return alert("××™ ××¤×©×¨ ×œ×©×œ×•×— ×”×•×“×¢×” ×¨×™×§×”!");

            document.getElementById('status').innerText = "×©×•×œ×—... ğŸš€";

            db.collection(COLLECTION_NAME).add({
                type: 'chat', // ×¡×™××•×Ÿ ×©×–×” ×¦'××˜ ×•×œ× ×ª××•× ×”
                text: text,
                user: name,
                tab: 'chat',
                likes: 0,
                date: firebase.firestore.FieldValue.serverTimestamp(),
                dev: navigator.userAgent.includes("Mobile")?"Mobile":"PC",
                uid: localStorage.getItem('uid') || (localStorage.setItem('uid', Math.random().toString(36).substr(2,5)), localStorage.getItem('uid'))
            }).then(() => {
                document.getElementById('status').innerText = "×”×”×•×“×¢×” × ×©×œ×—×”! âœ…";
                document.getElementById('chatInput').value = "";
            });
        }

        // ×”×¢×œ××ª ×ª××•× ×”
        function uploadFile() {
            const file = document.getElementById('fileInput').files[0];
            const name = document.getElementById('uploaderName').value;
            const desc = document.getElementById('descInput').value;
            
            if(!file) return;
            document.getElementById('status').innerText = "××¢×œ×”... ×¨×’×¢... â³";
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const max = 800; let w=img.width, h=img.height;
                    if(w>h){if(w>max){h*=max/w;w=max}}else{if(h>max){w*=max/h;h=max}}
                    canvas.width=w; canvas.height=h; ctx.drawImage(img,0,0,w,h);
                    
                    db.collection(COLLECTION_NAME).add({
                        type: 'image',
                        img: canvas.toDataURL('image/jpeg', 0.6),
                        user: name,
                        desc: desc,
                        tab: currentTab,
                        likes: 0,
                        date: firebase.firestore.FieldValue.serverTimestamp(),
                        dev: navigator.userAgent.includes("Mobile")?"Mobile":"PC",
                        uid: localStorage.getItem('uid') || (localStorage.setItem('uid', Math.random().toString(36).substr(2,5)), localStorage.getItem('uid'))
                    }).then(() => {
                        document.getElementById('status').innerText = "×”×•×¢×œ×” ×‘×”×¦×œ×—×”! âœ…";
                        document.getElementById('descInput').value = "";
                        document.getElementById('fileInput').value = "";
                    });
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // ×˜×¢×™× ×ª ×ª×•×›×Ÿ (×ª××•× ×•×ª ××• ×”×•×“×¢×•×ª)
        function loadContent() {
            db.collection(COLLECTION_NAME).orderBy("date", "desc").onSnapshot(snap => {
                const gal = document.getElementById('gallery'); 
                gal.innerHTML = "";
                
                snap.forEach(doc => {
                    const d = doc.data(); 
                    
                    // ×¡×™× ×•×Ÿ ×œ×¤×™ ×˜××‘×™×
                    if(d.tab !== currentTab) return;
                    
                    const id = doc.id;
                    let dateStr = "";
                    if(d.date) {
                        const dateObj = d.date.toDate();
                        dateStr = dateObj.toLocaleDateString('he-IL') + " | " + dateObj.toLocaleTimeString('he-IL', {hour:'2-digit', minute:'2-digit'});
                    }

                    const card = document.createElement('div'); 
                    card.className = 'card';
                    
                    // ×‘×“×™×§×” ×× ×–×” ×ª××•× ×” ××• ×¦'××˜
                    let contentHTML = "";
                    
                    if (d.type === 'chat') {
                        // ×¢×™×¦×•×‘ ×œ×¦'××˜
                        contentHTML = `
                            <div class="card-content">
                                <div class="user-name">ğŸ‘¤ ${d.user}</div>
                                <div class="upload-date">${dateStr}</div>
                                <div class="chat-text">${d.text}</div>
                            </div>
                        `;
                    } else {
                        // ×¢×™×¦×•×‘ ×œ×ª××•× ×”
                        contentHTML = `
                            <img src="${d.img}" onclick="openImg('${d.img}')">
                            <div class="card-content">
                                <div class="user-name">ğŸ‘¤ ${d.user}</div>
                                <div class="upload-date">${dateStr}</div>
                                ${d.desc ? `<div class="description">${d.desc}</div>` : ''}
                            </div>
                        `;
                    }

                    // ×›×¤×ª×•×¨×™× ××©×•×ª×¤×™× ×œ×›×•×œ×
                    card.innerHTML = contentHTML + `
                        <div class="card-content" style="padding-top:0;">
                            <div class="actions">
                                <button class="action-btn" onclick="addLike('${id}')">ğŸŒ ${d.likes||0}</button>
                                ${d.type !== 'chat' ? `<button class="action-btn" id="btn-com-${id}" onclick="toggleCom('${id}')">ğŸ’¬ ×ª×’×•×‘×•×ª</button>` : ''} 
                                ${d.type !== 'chat' ? `<button class="action-btn" onclick="postCom('${id}')">â• ×”×’×‘</button>` : ''}
                                <button class="delete-btn" onclick="deletePost('${id}')">ğŸ—‘ï¸ ××—×™×§×”</button>
                            </div>
                            <div class="spy">UID: ${d.uid}</div>
                            ${d.type !== 'chat' ? `<div class="comments" id="com-${id}">×˜×•×¢×Ÿ...</div>` : ''}
                        </div>`;
                        
                    gal.appendChild(card); 
                    
                    if(d.type !== 'chat') loadComments(id);
                });
            });
        }

        function addLike(id) { 
            db.collection(COLLECTION_NAME).doc(id).update({likes: firebase.firestore.FieldValue.increment(1)}); 
        }

        function deletePost(id) {
            if(confirm("×œ××—×•×§ ××ª ×–×”? ğŸ¤”")) {
                db.collection(COLLECTION_NAME).doc(id).delete();
            }
        }

        function toggleCom(id) { 
            const e = document.getElementById('com-'+id); 
            e.style.display = e.style.display==='block'?'none':'block'; 
        }

        function postCom(id) { 
            const u=prompt("×©× ×”××’×™×‘:");
            if(!u) return;
            const t=prompt("×ª×•×›×Ÿ ×”×ª×’×•×‘×”:"); 
            if(u&&t) db.collection(COLLECTION_NAME).doc(id).collection("comments").add({u, t, d: new Date()}); 
        }

        function loadComments(id) {
            db.collection(COLLECTION_NAME).doc(id).collection("comments").orderBy("d", "asc").onSnapshot(snap => {
                const e = document.getElementById('com-'+id); 
                const btn = document.getElementById('btn-com-'+id);
                if(btn) btn.innerText = `ğŸ’¬ ×ª×’×•×‘×•×ª (${snap.size})`;
                
                e.innerHTML = snap.empty ? "××™×Ÿ ×ª×’×•×‘×•×ª." : "";
                snap.forEach(doc => {
                    const c = doc.data(); 
                    e.innerHTML += `<div class="comment"><b>${c.u}:</b> ${c.t}</div>`;
                });
            });
        }
        
        loadContent();
    </script>
</body>
</html>
